<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>D√©mo Widget Chat IA</title>
  <style>body{font-family:system-ui,Arial,sans-serif;margin:0;padding:2rem}</style>
</head>
<body>
  <h1>D√©mo du Widget Chat IA</h1>
  <p>Collez ce bloc sur n'importe quel site. Remplacez l'URL Render ci-dessous.</p>

  <!-- === Widget Chat IA === -->
  <div id="caro-ai-widget"></div>
  <script>
  (function(){
    const CONFIG = {
      api_base: "https://REMPLACE-MOI.onrender.com", // ‚Üê remplace par ton URL Render
      client_id: "innerskin",
      welcome: "Bienvenue chez Innerskin üëã Comment puis-je vous aider ?",
    };

    const root = document.getElementById("caro-ai-widget");
    root.style.position="fixed"; root.style.right="20px"; root.style.bottom="20px"; root.style.zIndex="999999";
    root.innerHTML = `
      <button id="caro-bubble" style="all:unset;cursor:pointer;background:#111;color:#fff;padding:12px 14px;border-radius:999px;box-shadow:0 8px 24px rgba(0,0,0,.25)">üí¨ Discuter</button>
      <div id="caro-panel" style="display:none;position:fixed;right:20px;bottom:80px;width:360px;max-height:70vh;background:#fff;border-radius:16px;box-shadow:0 24px 60px rgba(0,0,0,.25);overflow:hidden">
        <div style="padding:12px 14px;border-bottom:1px solid #eee;font-weight:600">Assistant IA</div>
        <div id="caro-chat" style="padding:12px;height:360px;overflow:auto;font-size:14px;line-height:1.45">
          <div style="margin:8px 0;opacity:.8">${CONFIG.welcome}</div>
        </div>
        <div style="display:flex;gap:8px;padding:10px;border-top:1px solid #eee">
          <input id="caro-input" type="text" placeholder="√âcrivez votre message..." style="flex:1;padding:10px;border:1px solid #ddd;border-radius:10px;outline:none"/>
          <button id="caro-send" style="padding:10px 12px;border:0;border-radius:10px;background:#111;color:#fff;cursor:pointer">Envoyer</button>
        </div>
      </div>`;

    const bubble=document.getElementById("caro-bubble");
    const panel=document.getElementById("caro-panel");
    const chat=document.getElementById("caro-chat");
    const input=document.getElementById("caro-input");
    const send=document.getElementById("caro-send");

    bubble.onclick=()=>{ panel.style.display=(panel.style.display==="none"?"block":"none"); input.focus(); };

    send.onclick=async()=>{
      const text=input.value.trim(); if(!text) return; input.value="";
      add("user", text); typing(true);
      try{
        const r=await fetch(CONFIG.api_base+"/chat", {
          method:"POST", headers:{"Content-Type":"application/json"},
          body:JSON.stringify({ client_id: CONFIG.client_id, message: text })
        });
        const data=await r.json();
        add("bot", data.reply || "Erreur serveur");
      }catch(e){ add("bot","Impossible de joindre le serveur."); }
      typing(false);
    };

    input.addEventListener("keydown",(e)=>{ if(e.key==="Enter") send.click(); });

    function add(who,t){ const d=document.createElement("div"); d.style.margin="8px 0"; d.style.textAlign=(who==="user"?"right":"left");
      d.innerHTML=`<span style="display:inline-block;max-width:85%;padding:8px 10px;border-radius:12px;${who==="user"?"background:#111;color:#fff":"background:#f5f5f5;color:#111"}">${escape(t)}</span>`;
      chat.appendChild(d); chat.scrollTop=chat.scrollHeight; }
    function escape(s){return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");}
    function typing(on){ const id="caro-typing", old=document.getElementById(id);
      if(on && !old){ const e=document.createElement("div"); e.id=id; e.style.margin="8px 0"; e.innerHTML=`<span style="display:inline-block;background:#f5f5f5;padding:8px 10px;border-radius:12px">‚ãØ</span>`; chat.appendChild(e); chat.scrollTop=chat.scrollHeight; }
      if(!on && old){ old.remove(); } }
  })();
  </script>
</body>
</html>
